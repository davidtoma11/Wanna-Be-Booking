TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER check_dates_before_insert\nBEFORE INSERT ON reservations\nFOR EACH ROW\nBEGIN\n    -- Verifică dacă data de check-out este mai mare cu cel puțin 1 zi față de check-in\n    IF DATEDIFF(NEW.check_out, NEW.check_in) < 1 THEN\n        SIGNAL SQLSTATE \'45000\' SET MESSAGE_TEXT = \'Check-out date must be at least one day after check-in date\';\n    END IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER check_room_availability\nBEFORE INSERT ON reservations\nFOR EACH ROW\nBEGIN\n    -- Verifică dacă există o rezervare confirmată pe aceeași cameră în perioada dorită\n    IF EXISTS (\n        SELECT 1 \n        FROM reservations\n        WHERE room_id = NEW.room_id\n        AND status = \'confirmed\'  -- Verifică doar rezervările confirmate\n        AND (\n            (NEW.check_in BETWEEN check_in AND check_out) \n            OR (NEW.check_out BETWEEN check_in AND check_out)\n            OR (check_in BETWEEN NEW.check_in AND NEW.check_out)\n            OR (check_out BETWEEN NEW.check_in AND NEW.check_out)\n        )\n    ) THEN\n        SIGNAL SQLSTATE \'45000\'\n        SET MESSAGE_TEXT = \'The room is already booked for this period.\';\n    END IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER before_insert_reservation_date_check\nBEFORE INSERT ON reservations\nFOR EACH ROW\nBEGIN\n    -- Verificăm dacă data de check-in este anterioară datei curente\n    IF NEW.check_in < CURRENT_DATE THEN\n        SIGNAL SQLSTATE \'45000\'\n        SET MESSAGE_TEXT = \'Data de check-in nu poate fi anterioară datei curente.\';\n    END IF;\nEND'
sql_modes=1098907648 1098907648 1098907648
definers='root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8mb4' 'utf8mb4' 'utf8mb4'
connection_cl_names='utf8mb4_unicode_ci' 'utf8mb4_unicode_ci' 'utf8mb4_unicode_ci'
db_cl_names='utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci'
created=1739632092184505 1739632973177669 1739649210451227
